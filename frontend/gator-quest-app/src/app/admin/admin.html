<div class="admin-container">
  <header class="admin-header">
    <h1>Admin Dashboard</h1>
    <button class="logout-btn" (click)="onLogout()">
      <i class="pi pi-sign-out"></i> Logout
    </button>
  </header>

  <div class="tabs">
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'players'"
      (click)="activeTab = 'players'">
      Players
    </button>
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'users'"
      (click)="activeTab = 'users'">
      Users
    </button>
  </div>

  <div *ngIf="loading" class="loading">Loading...</div>
  <div *ngIf="error" class="error">{{ error }}</div>

  <!-- Players Tab -->
  <div *ngIf="activeTab === 'players' && !loading" class="content">
    <div class="content-header">
      <h2>All Players</h2>
      <button class="refresh-btn" (click)="refreshPlayers()" title="Refresh player data">
        <i class="pi pi-refresh"></i> Refresh
      </button>
    </div>
    <table class="data-table">
      <thead>
        <tr>
          <th>Username</th>
          <th>GPA</th>
          <th>Energy</th>
          <th>Social</th>
          <th>Story Progress</th>
          <th>Games Played</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let player of players">
          <td>{{ player.name }}</td>
          <td>{{ player.gpa?.toFixed(2) }}</td>
          <td>{{ player.energy }}</td>
          <td>{{ player.social }}</td>
          <td>{{ player.currentStoryIndex }} / 20</td>
          <td>{{ player.gamesPlayed || 0 }}</td>
          <td>
            <span class="status-badge" [class.completed]="player.storiesCompleted">
              {{ player.storiesCompleted ? 'Completed' : 'In Progress' }}
            </span>
          </td>
          <td>
            <button class="delete-btn" (click)="deletePlayer(player._id)">
              <i class="pi pi-trash"></i>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Users Tab -->
  <div *ngIf="activeTab === 'users' && !loading" class="content">
    <div class="content-header">
      <h2>All Users</h2>
      <button class="refresh-btn" (click)="refreshUsers()" title="Refresh user data">
        <i class="pi pi-refresh"></i> Refresh
      </button>
    </div>
    <table class="data-table">
      <thead>
        <tr>
          <th>Username</th>
          <th>Role</th>
          <th>Created</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of users">
          <td>{{ user.email }}</td>
          <td>
            <span class="role-badge" [class.admin-badge]="user.role === 'admin'">
              {{ user.role }}
            </span>
          </td>
          <td>{{ user.createdAt | date:'short' }}</td>
          <td>
            <button 
              *ngIf="user.role !== 'admin'" 
              class="delete-btn" 
              (click)="deleteUser(user._id)">
              <i class="pi pi-trash"></i>
            </button>
            <span *ngIf="user.role === 'admin'" class="protected-label">Protected</span>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
